name: Continuous Integration

on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main

permissions:
  contents: read

jobs:
  test-typescript:
    name: TypeScript Tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version-file: .node-version
          cache: npm

      - name: Debug - Verify structure
        run: |
          echo "=== DEBUG START ==="
          echo "Workspace: ${{ github.workspace }}"
          echo "Current directory:"
          pwd
          echo "---"
          echo "All files in root:"
          ls -la
          echo "---"
          echo "Backend directory contents:"
          ls -la backend/ || echo "ERROR: backend/ directory not found!"
          echo "---"
          echo "package-lock.json exists?"
          ls -la backend/package-lock.json || echo "ERROR: package-lock.json not found in backend/"
          echo "=== DEBUG END ==="

      - name: Install Dependencies
        run: |
          cd backend
          npm ci

      - name: Type Check
        run: |
          cd backend
          npm run build

      - name: Test
        run: |
          cd backend
          npm run test:unit